<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TP Temps Réel</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="page">
      <section class="panel auth-panel" id="auth-panel">
        <h1>Mini app temps réel</h1>
        <p class="panel-subtitle">Identifiez-vous pour synchroniser vos items.</p>
        <form id="login-form" class="card">
          <label class="field">
            <span>Pseudo</span>
            <input type="text" name="pseudo" required minlength="3" maxlength="20" pattern="[A-Za-z0-9_-]+" />
          </label>
          <label class="field">
            <span>Secret local (min. 6 caractères)</span>
            <input type="password" name="secret" required minlength="6" maxlength="50" />
          </label>
          <button type="submit" class="primary-btn">Créer/Rejoindre la session</button>
          <p id="login-error" class="error-text hidden"></p>
        </form>
        <p class="hint">
          Réutilisez le même pseudo + secret pour retrouver vos items personnels.
        </p>
      </section>

      <section class="panel app-panel hidden" id="app-panel">
        <header class="app-header">
          <div>
            <h1>Liste partagée</h1>
            <p class="status-line">
              Connecté en tant que <span id="user-label"></span>
              <span id="connection-status" class="status-dot offline">hors ligne</span>
            </p>
          </div>
          <div class="actions">
            <button id="logout-btn">Se déconnecter</button>
          </div>
        </header>

        <section class="card composer">
          <form id="item-form">
            <label class="field">
              <span>Nouvel item</span>
              <input
                type="text"
                id="item-input"
                placeholder="Décrivez l’item (max 280 caractères)"
                maxlength="280"
                required
              />
            </label>
            <button type="submit" class="primary-btn">Ajouter</button>
          </form>
        </section>

        <section class="grid">
          <div class="card">
            <div class="card-header">
              <h2>Items synchronisés</h2>
              <span id="item-count" class="muted"></span>
            </div>
            <ul id="items-list" class="items-list"></ul>
          </div>

          <div class="card side-panel">
            <h2>Monitoring</h2>
            <ul class="metrics">
              <li><strong>Connexions actives</strong> <span id="connections-count">0</span></li>
              <li><strong>Utilisateurs</strong> <span id="users-count">0</span></li>
              <li><strong>Latence estimée</strong> <span id="latency-value">-</span></li>
              <li><strong>Actions traitées</strong> <span id="metrics-count">0</span></li>
            </ul>

            <h3>Utilisateurs connectés</h3>
            <ul id="users-list" class="users-list"></ul>

            <h3>Logs de synchro</h3>
            <ul id="logs-list" class="logs-list"></ul>
          </div>
        </section>
      </section>
    </main>

    <template id="item-template">
      <li class="item">
        <div>
          <p class="item-text"></p>
          <small class="muted item-meta"></small>
        </div>
        <div class="item-actions">
          <button class="ghost-btn edit-btn">Modifier</button>
          <button class="ghost-btn danger delete-btn">Supprimer</button>
        </div>
      </li>
    </template>

    <script src="./app.js" type="module"></script>
  </body>
</html>
